<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            background-color: #333;
        }

        #Name {
            color: #3eb6ed;
            font-size: 3rem;
            margin-top: 20px;
            /* Adjust the margin-top value to move the heading up */
        }

        h2 {
            color: white;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .button {
            color: white;
            background-color: rgb(38, 79, 146);
            font-size: 1.5rem;
            padding: 10px 0;
            border-radius: 10px;
            border: none;
            margin-bottom: 20px;
            width: 300px;
            /* Add initial glowing effect */
            box-shadow: 0 0 10px rgb(38, 79, 146);
            /* Add transition for smooth effect */
            transition: box-shadow 0.3s ease-in-out;
        }

        .button:hover {
            /* Expand glowing effect on hover */
            box-shadow: 0 0 20px rgb(38, 79, 146);
        }

        a#return-link {
            position: absolute;
            top: 20px;
            left: 20px;
            /* Updated left position to move the image to the top left corner */
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: transform 0.3s ease-in-out;
        }

        #upload-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 100px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            color: white;
            font-size: 2rem;
            text-align: center;
            line-height: 100px;
        }
    </style>
    <title>Airdrop</title>
    <!-- 省略前面的HTML和CSS部分 -->
    <script>
        function handleFileUpload() {
            // 创建文件上传输入框
            const fileInput = document.createElement('input');
            fileInput.type = 'file';

            // 监听文件选择事件
            fileInput.addEventListener('change', (event) => {
                const selectedFile = event.target.files[0];
                if (selectedFile) {
                    // 创建 FormData 对象并将选中的文件添加到其中
                    const formData = new FormData();
                    formData.append('file', selectedFile);

                    // 使用 Fetch API 发送文件上传请求
                    fetch('/upload', {
                        method: 'POST',
                        body: formData,
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            // 处理来自服务器的响应
                            console.log(data);
                            // 弹窗显示验证码
                            alert('文件上传成功，验证码为: ' + data.verificationCode);
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            alert('文件上传失败：' + error.message);
                        });
                }
            });

            // 触发文件选择
            fileInput.click();
        }

        function handleFileDownload() {
            // 获取用户输入的验证码
            const verificationCode = prompt('请输入6位验证码:');
            if (verificationCode && verificationCode.length === 6) {
                // 使用 Fetch API 发送带有验证码的文件下载请求
                fetch(`/download?verificationCode=${verificationCode}`, {
                    method: 'GET',
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error('文件下载失败');
                        }

                        // 从响应头中提取文件名
                        const contentDisposition = response.headers.get('content-disposition');
                        const filename = contentDisposition
                            ? contentDisposition.split('filename=')[1]
                            : 'unknown';

                        // 将响应内容转换为blob
                        return response.blob().then((blob) => ({ blob, filename }));
                    })
                    .then((data) => {
                        // 创建临时链接并模拟点击下载
                        const downloadLink = document.createElement('a');
                        const url = URL.createObjectURL(data.blob);
                        downloadLink.href = url;
                        downloadLink.download = data.filename;
                        downloadLink.click();

                        // 释放链接资源
                        URL.revokeObjectURL(url);

                        // 删除该文件
                        fetch(`/delete?verificationCode=${verificationCode}`, {
                            method: 'DELETE',
                        }).then(() => {
                            alert('文件下载成功并已删除！');
                        });
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        alert('文件下载失败：' + error.message);
                    });
            } else {
                alert('请输入有效的6位验证码！');
            }
        }
    </script>
</head>

<body>
    <h1 id="Name">Airdrop</h1>
    <h2>一个免费开源的Web传输工具</h2>
    <div class="button-container">
        <!-- 添加点击事件来触发文件选择 -->
        <button class="button" id="upload" type="button" onclick="handleFileUpload()">
            上传
        </button>
        <button class="button" id="download" type="button" onclick="handleFileDownload()">
            下载
        </button>
    </div>
</body>

</html>